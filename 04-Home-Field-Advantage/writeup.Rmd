---
title: "04-home-field-advantage"
author: "Shaswat Rajput"
output: html_notebook
---
```{r ,echo=TRUE, include=FALSE}
library(dplyr)
library(ggplot2)
library(magrittr)
```

## If home field advantage exists, how much of an impact does it have on winning the world series? <br>

### SETUP :
<li> Suppose that the Braves and the Yankees are teams competing in the World Series.</li>
<li> The table below has the two possible schedules for each game of the series. (NYC = New York City, ATL = Atlanta) </li><br>

| Overall advantage | Game 1 | Game 2 | Game 3 | Game 4 | Game 5 | Game 6 | Game 7 |
|:-----------------:|:------:|:------:|:------:|:------:|:------:|:------:|:------:|
|       Braves      |   ATL  |   ATL  |   NYC  |   NYC  |   NYC  |   ATL  |   ATL  |
|      Yankees      |   NYC  |   NYC  |   ATL  |   ATL  |   ATL  |   NYC  |   NYC  |

<li> Let *P*<sub>*B*</sub> be the probability that the Braves win a
    single head-to-head match-up with the Yankees, under the assumption
    that home field advantage doesn’t exist. Let
    *P*<sub>*B*</sub><sup>*H*</sup> denote the probability that the
    Braves win a single head-to-head match-up with the Yankees as the
    home team (H for home). Let *P*<sub>*B*</sub><sup>*A*</sup> denote
    the probability that the Braves win a single head-to-head match-up
    with the away team (A for away).</li>
| Game location |    No advantage   | Advantage                                                            |
|:-------------:|:-----------------:|:---------------------------------------------------------------------|
|      ATL      | *P*<sub>*B*</sub> | *P*<sub>*B*</sub><sup>*H*</sup> = *P*<sub>*B*</sub> \* 1.1           |
|      NYC      | *P*<sub>*B*</sub> | *P*<sub>*B*</sub><sup>*A*</sup> = 1 − (1 − *P*<sub>*B*</sub>) \* 1.1 |
<br>


1. Compute analytically the probability that the Braves win the world series when the sequence of game locations is {NYC, NYC, ATL, ATL, ATL, NYC, NYC}. Calculate the probability with and without home field advantage when P<sub>b</sub>= 0.55. What is the difference in probabilities?

```{r}
require(dplyr)
require(data.table)
# Get all possible outcomes
apo <- fread("all-possible-world-series-outcomes.csv")
set.seed(44)
hfi <- c(0,0,1,1,1,0,0) # {NYC, NYC, ATL, ATL, ATL, NYC, NYC}
pb <- 0.55
advantage_multiplier <- 1.1
pbh <- 0.55*advantage_multiplier
pba <- 1 - (1 - 0.55)*advantage_multiplier

# Without Home Advantage
analy_without<- pbinom(3,7,pb,lower.tail = F)

# With home Aadvantage 
apo[, p := NA_real_] # Initialize new column in apo to store prob
for(i in 1:nrow(apo)){
  prob_game <- rep(1, 7)
  for(j in 1:7){
    p_win <- ifelse(hfi[j], pbh, pba)
    prob_game[j] <- case_when(
        apo[i,j,with=FALSE] == "W" ~ p_win
      , apo[i,j,with=FALSE] == "L" ~ 1 - p_win
      , TRUE ~ 1
    )
  }
  apo[i, p := prod(prob_game)] # Data.table syntax
}

# Sanity check: does sum(p) == 1?
apo[, sum(p)] # This is data.table notation

# Probability of overall World Series outcomes
apo[, sum(p), overall_outcome]

```
There is difference in the analytical method if the team has advantage or without it. 
Absolute Error = 0.6082878 - 0.604221	= 0.0040668
Relative error = 0.0040668/0.6082878 = 0.00668565

2.Calculate the same probabilities as the previous question by simulation.

```{r}
# Without home advantage 
without_home_adv<-mean(rbinom(10000000,7,0.55)>3)
without_home_adv
#With Home Advantage
with_adv <- mean((rbinom(100000,4,pba)+ rbinom(100000,3,pbh))>3)
with_adv
```


3. What is the absolute and relative error for your simulation in the previous question?

```{r}
# Mean absolute Error (with home advantage)
(0.604221	 - with_adv)
# Relative Error (with home advantage)
(0.604221	 - with_adv)/0.604221

#Mean absolute Error (without home advantage)
analy_without - without_home_adv

## Relative Error (without home advantage)
(analy_without-without_home_adv)/analy_without

```




























```






